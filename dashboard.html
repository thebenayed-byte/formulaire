<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - Inscrits</title>

<style>
body{
    background:#0f0f0f;
    color:white;
    font-family:Segoe UI;
    padding:20px;
}

h1{
    text-align:center;
    margin-bottom:20px;
    color:#00bcd4;
}

table{
    width:100%;
    border-collapse:collapse;
    background:#1c1c1c;
    border-radius:10px;
    overflow:hidden;
}

th, td{
    padding:12px;
    text-align:left;
}

th{
    background:#222;
    color:#00bcd4;
}

tr:nth-child(even){
    background:#1a1a1a;
}

tr:hover{
    background:#00bcd4;
    color:#000;
    cursor:pointer;
    transition:0.3s;
}

.details{
    margin-top:30px;
    background:#1c1c1c;
    padding:20px;
    border-radius:15px;
    display:none;
}

input, select{
    padding:8px;
    margin:5px 0;
    border-radius:8px;
    border:none;
    width:200px;
}

button{
    padding:8px 12px;
    border:none;
    border-radius:8px;
    background:#00bcd4;
    color:white;
    cursor:pointer;
    margin-top:10px;
}
</style>
</head>

<body>

<h1>Liste des Inscrits</h1>

<table id="tableau">
    <thead>
        <tr>
            <th>Nom</th>
            <th>Prénom</th>
            <th>École</th>
            <th>Classe</th>
            <th>Paiement total (KMF)</th>
        </tr>
    </thead>
    <tbody>
        <!-- Les inscrits seront ajoutés ici par JS -->
    </tbody>
</table>

<div class="details" id="details"></div>

<script>
// Sécurité : accès admin seulement
if(sessionStorage.getItem("admin") !== "true"){
    window.location.href="merci.html";
}

// Récupérer les inscrits
let data = JSON.parse(localStorage.getItem("eleves")) || [];
let tbody = document.querySelector("#tableau tbody");
let details = document.getElementById("details");

// Fonction pour calculer le total des paiements d'un élève
function totalPaiements(paiements){
    let total = 0;
    for(let mois in paiements){
        total += Number(paiements[mois] || 0);
    }
    return total;
}

// Remplir le tableau
data.forEach(eleve=>{
    let tr = document.createElement("tr");
    tr.innerHTML = `
        <td>${eleve.nom}</td>
        <td>${eleve.prenom}</td>
        <td>${eleve.ecole}</td>
        <td>${eleve.classe}</td>
        <td>${totalPaiements(eleve.paiements)}</td>
    `;
    tr.onclick = ()=>showDetails(eleve.id);
    tbody.appendChild(tr);
});

// Fonction afficher détails
function showDetails(id){
    let eleve = data.find(e=>e.id===id);
    details.style.display="block";

    details.innerHTML = `
    <h2>${eleve.nom} ${eleve.prenom}</h2>
    <p>Email: ${eleve.email}</p>
    <p>Téléphone: ${eleve.tel}</p>
    <p>École: ${eleve.ecole}</p>
    <p>Classe: ${eleve.classe}</p>

    <h3>Paiements mensuels</h3>
    <input type="month" id="mois">
    <input type="number" id="montant" placeholder="Montant">
    <button onclick="ajouterPaiement(${eleve.id})">Ajouter / Modifier</button>

    <div id="historique"></div>
    `;

    afficherPaiements(eleve);
}

function ajouterPaiement(id){
    let mois = document.getElementById("mois").value;
    let montant = document.getElementById("montant").value;

    if(!mois || !montant) return alert("Veuillez remplir mois et montant");

    let eleve = data.find(e=>e.id===id);
    eleve.paiements[mois] = montant;

    localStorage.setItem("eleves", JSON.stringify(data));
    afficherPaiements(eleve);

    // Mettre à jour le tableau total
    tbody.innerHTML="";
    data.forEach(e=>{
        let tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${e.nom}</td>
            <td>${e.prenom}</td>
            <td>${e.ecole}</td>
            <td>${e.classe}</td>
            <td>${totalPaiements(e.paiements)}</td>
        `;
        tr.onclick = ()=>showDetails(e.id);
        tbody.appendChild(tr);
    });
}

function afficherPaiements(eleve){
    let historique = document.getElementById("historique");
    historique.innerHTML="<h4>Historique:</h4>";

    for(let mois in eleve.paiements){
        historique.innerHTML += `<p>${mois} : ${eleve.paiements[mois]} KMF</p>`;
    }
}
</script>

</body>
</html>
